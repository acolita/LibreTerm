# LibreTerm v1.4.0 Plan (Jump Servers)

**Goal:** Implement robust support for **Jump Servers (Bastion Hosts)** to allow connecting to target servers via an intermediary, simplifying complex network access.

## 1. Feature: Jump Servers (Bastion Hosts)
*   **Concept:** Route a connection through an intermediary server (Jump Host) to reach a target server that is not directly accessible.
*   **User Experience:**
    *   User defines a standard connection for the Bastion/Jump Host (e.g., "MyBastion").
    *   User creates/edits a target connection (e.g., "InternalServer").
    *   In the "Connection Details" dialog, user selects "MyBastion" from a new "Jump Server" dropdown.
    *   When "InternalServer" is launched, LibreTerm handles the tunneling automatically.

## 2. Technical Strategy: `plink.exe` Proxy
*   **Mechanism:** Use PuTTY's `-proxycmd` option to pipe traffic through `plink.exe`.
*   **Command Construction:**
    `putty.exe [TargetOptions] -proxycmd "plink.exe [JumpOptions] -nc %host:%port"`
*   **JumpOptions:** Needs to include the Jump Host's host, port, user, password/key (resolved from its credential alias if set).
*   **TargetOptions:** Standard target host options.

## 3. UI Updates
*   **Connection Dialog (`IDD_CONNECTION`):**
    *   Add `LTEXT "Jump Server:"`
    *   Add `COMBOBOX IDC_COMBO_JUMP_SERVER`
*   **Settings Dialog (`IDD_SETTINGS`):**
    *   Add `LTEXT "Plink Path:"`
    *   Add `EDITTEXT IDC_EDIT_PLINK_PATH`
    *   Add `BUTTON "Browse..."`

## 4. Data Model Changes
*   **Connection Struct:** Add `std::wstring jumpHostConnectionName`. (Storing the *Name* is safer than index, though assuming unique names or using a UUID would be best. For this MVP, we match by Name).
*   **ConnectionManager:** Update `Load/Save` to persist this new field.
    *   Update `SavePlinkPath` / `LoadPlinkPath`.

## 5. Implementation Steps
1.  **Resources:** Update `resource.h` and `LibreTerm.rc` with new controls.
2.  **Settings:** Implement Plink path configuration (auto-detect if in same dir as PuTTY).
3.  **UI Logic:** Populate "Jump Server" combo in `ConnectionDialogProc` with other connections (excluding self to avoid loops, though 1-level check is fine).
4.  **Launch Logic:**
    *   In `LaunchSession`, check if `jumpHostConnectionName` is set.
    *   If yes, find the Jump Connection object.
    *   Resolve Jump Credentials.
    *   Construct the `-proxycmd` string.
    *   Launch.

## 6. Testing
*   **Configuration:** Verify Plink path saves.
*   **UI:** Verify Jump Server list populates.
*   **Execution:** (Manual/Mock) Verify the generated command line includes the correct `-proxycmd`.