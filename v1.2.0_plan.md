# LibreTerm v1.2.0 Plan (Automation & Efficiency)

**Goal:** Enhance user productivity by enabling rapid execution of pre-defined commands (Snippets) and ad-hoc commands via a Quick Command Bar.

## 1. Feature: Snippet Manager
*   **Concept:** A centralized library of reusable command snippets (e.g., "apt update", "tail -f /var/log/syslog").
*   **UI:** A modeless dialog window (`IDD_SNIPPETS`) accessible via **Tools -> Snippet Manager**.
    *   **List:** Displays snippet names.
    *   **Controls:** Add, Edit, Delete.
    *   **Actions:**
        *   "Send": Types the snippet into the *active* session.
        *   "Send to All": Types the snippet into *all* sessions.
*   **Storage:** `snippets.json` (Managed by a new `SnippetManager` class).
*   **Data Model:** `struct Snippet { std::wstring name; std::wstring content; }`.

## 2. Feature: Quick Command Bar
*   **Concept:** A toolbar area to type a single line command and send it to the active session (or all, if broadcast is on).
*   **UI:**
    *   Located at the top of the **Tab Area** (above the actual tabs, but to the right of the Sidebar).
    *   **Controls:**
        *   `Edit Control`: For typing the command.
        *   `Button ("Send")`: Triggers the send action.
        *   `Checkbox ("Enter")`: If checked, automatically sends `\n` after the command.
*   **Interaction:**
    *   `Enter` key in the box triggers "Send".
    *   Respects the global "Broadcast Mode" setting (if Broadcast is on, sends to all).

## 3. Technical Implementation
1.  **Backend (`SnippetManager`):**
    *   Simple Load/Save logic using `json` (reuse existing JSON helpers if possible or extend).
2.  **UI Resources (`resource.h`, `LibreTerm.rc`):**
    *   `IDD_SNIPPETS` (Dialog).
    *   `IDD_SNIPPET_EDIT` (Dialog for creating/editing).
    *   Menu item: `IDM_TOOLS_SNIPPETS`.
3.  **MainWindow Integration:**
    *   **Layout:** Update `OnSize` to reserve space for the Quick Command Bar above `m_hTabControl`.
    *   **Controls:** Create `m_hQuickEdit`, `m_hQuickBtn`, `m_hQuickEnterCheck`.
    *   **Logic:** Implement `OnQuickSend()` which calls `InputHook` or `PostMessage` to the embedded window(s).
4.  **Send Logic:**
    *   Refactor `BroadcastKey` or create a new helper `SendTextToSession(Session* s, wstring text)` to handle string sending (simulating keystrokes or `WM_CHAR`).
    *   *Note:* `WM_CHAR` is usually sufficient for PuTTY.

## 4. Tests
*   **Unit/Integration:** Test `SnippetManager` load/save.
*   **E2E:**
    *   Open Snippet Manager, Add Snippet.
    *   Select Snippet, Click Send -> Verify text appears in Terminal (via screen scrape or accessibility text check if possible, otherwise rely on manual verification/no crash).
    *   Type in Quick Command Bar -> Enter -> Verify text sent.
