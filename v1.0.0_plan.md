# LibreTerm v1.0.0 Plan (Credential Manager)

**Goal:** Implement a centralized Credential Manager to allow users to define reusable authentication profiles (Alias -> User/Password/Key), significantly improving workflow for organizations with shared credentials.

## 1. Core Feature: Credential Manager
*   **Concept:** Decouple authentication from connections. A Connection can reference a Credential Profile by alias.
*   **Data Model:**
    *   `Credential` Struct:
        *   `Alias` (Unique Name)
        *   `Username`
        *   `Password` (Clear text for now, per requirement)
        *   `PrivateKeyPath` (Optional)
    *   **Storage:** `credentials.ini` (standardized with `connections.ini`).

## 2. UI Updates
*   **Credential Manager Dialog (`IDD_CREDENTIAL_MANAGER`):**
    *   A management interface accessible via **Tools -> Credential Manager**.
    *   **List:** Shows defined aliases.
    *   **Actions:** Add, Edit, Delete.
    *   **Editor:** Form to input Alias, User, Password, Private Key path.
*   **Connection Dialog (`IDD_CONNECTION`):**
    *   **New Control:** A `ComboBox` to select a stored Credential Alias.
    *   **Behavior:**
        *   If a credential is selected, the User/Password fields in the dialog are disabled or ignored (or pre-filled/synced).
        *   Option to "Default" (No Credential) to enter manual details.

## 3. Integration Logic
*   **Connection Struct:** Add `std::wstring credentialAlias`.
*   **Launch Flow:**
    1.  Check if `conn.credentialAlias` is set.
    2.  If yes, look up `Credential` from `CredentialManager`.
    3.  Use the looked-up Username/Password/Key for the PuTTY/WinSCP command line.
    4.  If no alias, fall back to the `conn.user` and `conn.password` stored in the connection.

## 4. Automation & Testing (E2E)
*   **New Tests:**
    *   `test_credential_crud`: Open Manager, Add "TestCred", Verify in list, Edit, Delete.
    *   `test_connection_with_credential`: Create Connection, Select "TestCred", Save, Verify integration (launch logic might be hard to verify purely via UI without checking process args, but we can verify UI state).

## 5. Implementation Steps
1.  **Resources:** Add Dialogs (`IDD_CREDENTIALS`, `IDD_CREDENTIAL_EDIT`) and Menu Item.
2.  **Backend:** Create `CredentialManager` class (Load/Save/Find).
3.  **UI Logic:** Implement `CredentialManagerDialogProc`.
4.  **Integration:** Update `ConnectionDialogProc` to populate and handle the ComboBox.
5.  **Execution:** Update `LaunchSession` to resolve aliases.
6.  **Tests:** Update `test_basic.py` with new scenarios.
